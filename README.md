# stempol_db_api

Deze API is een Spring Boot project die de communicatie tussen de database en de client verzorgt. Voor alle endpoints met uitzondering van /privacy (benodigd voor Google, anders kom je de Play Store niet in) en /health geldt dat er een geldig JWT in de header van elke request moet zitten. Deze JWT komt van [de auth API](https://github.com/ruudschiphorst/stempol_auth_api). 

Deze API implementeert op een basisniveau autorisaties. Dat wil zeggen dat in NotesController wat logica zit: userID's die in queries worden gestopt voor basisfiltering. Op details wordt in de API gefilterd, bijvoorbeeld voor het opvragen van vorige versies van notities: die dienen niet afgeschermd te zijn en je dient zelf de eigenaar te zijn van de notitie of op andere manier hebben bijgedragen aan de notitie. 

De API implementeert, zoals hierboven al werd gesuggereerd, meerdere versies van een notitie. Bij het opslaan van een notitie wordt gecontroleerd of de notitie reeds bestaat. Zo ja, dan wordt het volgnummer opgehoogd en er wordt een nieuwe record aangemaakt in de database met het nieuwe volgnummer. Standaard wordt alleen de laatste versie van een notitie getoond, mits deze niet verwijderd is: in dat geval wordt de meest recente, niet verwijderde versie getoond.

De API biedt ruimte voor het opslaan van multimedia, op dit moment alleen geimplementeerd voor foto's. Foto's zijn onderdeel van de data die (in JSON) naar de client wordt verzonden. Dit gebeurt door de ruwe data te converteren naar een Byte Array, deze als Base64 te encoden en vervolgens op te nemen in de JSON. De client kan de Base64 decoden en heeft vervolgens de ruwe data om de foto weer te tonen. 

Tot slot even wat bijzondere informatie over de Repositories die worden gebruikt. Vrijwel alle queries die door de repo's worden gegenereerd zijn custom queries, daar waar vrijwel elke query een of meerdere parameters nodig heeft, zoals bijvoorbeeld de UserID. Daarnaast implementeren de repo's allemaal een refreshable repository: Spring haalt default niet de data opnieuw op nadat er iets wordt toegevoegd of verwijderd uit de database. Dit is niet wenselijk bij het uploaden van multimedia, omdat er records aangemaakt worden die relateren aan een nieuwe notitie-record. Als Spring nog niet doorheeft dat dat record bestaat en ook geen ID teruggeeft, dan is het opslaan van multimedia onmogelijk zonder gecompliceerde workarounds. 
